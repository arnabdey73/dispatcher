<VirtualHost *:80>
  RequestHeader set X-Forwarded-Proto "http"

  RewriteEngine On
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName beta.axa.ch
  RewriteEngine On
  LogLevel debug
  RewriteRule ^/$ /de/privatkunden.html [R=301,L]
  RewriteCond %{REQUEST_URI} !^/(apps|bin|etc|home|libs|tmp|var|content|dispatcher)/
  RewriteRule ^/(.*)$ /content/axa/$1 [PT]

  RequestHeader set X-Forwarded-Proto "https"

  SSLEngine On
  SSLCertificateFile "/etc/httpd/conf/certs/beta.axa.ch.crt"
  SSLCertificateKeyFile "/etc/httpd/conf/certs/beta.axa.ch.key"

  <Location />
    SSLRequireSSL
  </Location>

  <Directory />
    ModMimeUsePathInfo On

    Options FollowSymLinks
    AllowOverride None

    <IfModule disp_apache2.c>
      SetHandler dispatcher-handler
    </IfModule>
  </Directory>
</VirtualHost>
